<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Stillwater Admin Dojo — local orchestration dashboard for the Stillwater AI agent system">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self'; base-uri 'self'">
  <title>Stillwater Admin Dojo</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- App styles -->
  <link rel="stylesheet" href="app.css">
</head>
<body>

  <!-- ======================================================
       TOPBAR
       ====================================================== -->
  <nav class="topbar">
    <div class="topbar-inner">
      <div class="topbar-left">
        <img src="../images/droplet-logo.png" alt="Stillwater" class="topbar-logo-img">
        <span class="topbar-brand">Stillwater</span>
        <span class="topbar-subtitle">Admin Dojo</span>
      </div>
      <div class="topbar-right">
        <span class="server-status-badge" id="serverStatus" role="status" aria-live="polite">Connecting...</span>
        <button class="server-retry-btn" id="btnRetryHealth" type="button" aria-label="Retry server health check">Retry</button>
      </div>
    </div>
  </nav>

  <!-- ======================================================
       MAIN LAYOUT
       ====================================================== -->
  <div class="main-layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-heading">System Status</div>

      <!-- LLM Portal card -->
      <div class="status-card card-llm" id="cardLLM">
        <div class="status-dot-wrap">
          <span class="status-dot dot-llm"></span>
        </div>
        <div class="status-card-body">
          <div class="status-card-title">LLM Portal</div>
          <div class="status-card-status" id="llmStatus">Loading...</div>
          <div class="status-card-detail" id="llmDetail"></div>
          <button class="btn-configure" id="btnConfigLLM">Configure</button>
        </div>
      </div>

      <!-- Solace AGI card -->
      <div class="status-card card-solace" id="cardSolace">
        <div class="status-dot-wrap">
          <span class="status-dot dot-solace"></span>
        </div>
        <div class="status-card-body">
          <div class="status-card-title">Solace AGI</div>
          <div class="status-card-status" id="solaceStatus">Loading...</div>
          <div class="status-card-detail" id="solaceDetail"></div>
          <button class="btn-configure" id="btnConfigSolace">Configure</button>
        </div>
      </div>

      <!-- Skills Ecosystem card -->
      <div class="status-card card-skills" id="cardSkills">
        <div class="status-dot-wrap">
          <span class="status-dot dot-skills"></span>
        </div>
        <div class="status-card-body">
          <div class="status-card-title">Skills Ecosystem</div>
          <div class="status-card-status" id="skillsStatus">Loading...</div>
          <div class="status-card-detail" id="skillsDetail"></div>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">

      <!-- TAB BAR -->
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="orchestration">Orchestration</button>
        <button class="tab-btn" data-tab="skills">Skills</button>
        <button class="tab-btn" data-tab="swarms">Swarms</button>
        <button class="tab-btn" data-tab="personas">Personas</button>
        <button class="tab-btn" data-tab="recipes">Recipes</button>
      </div>

      <!-- ================================================
           TAB: DASHBOARD
           ================================================ -->
      <div class="tab-pane active" id="tab-dashboard">
        <div class="tab-welcome">
          <h2 class="welcome-heading">Stillwater Admin</h2>
          <p class="welcome-desc">
            Stillwater is an AI agent orchestration system. This dashboard lets you monitor your local Stillwater server, browse the architecture of each module, and connect your LLM provider. Start your server with
            <code>stillwater serve</code>, then configure your LLM and watch your agents work.
          </p>
        </div>

        <!-- Hero Cards Grid: 5 local modules -->
        <div class="hero-grid">

          <div class="hero-card" data-navigate="orchestration">
            <div class="hero-card-img-wrap">
              <img src="../images/droplets/orchestration.png" alt="Orchestration">
            </div>
            <div class="hero-card-body">
              <h4 class="hero-card-title">Orchestration</h4>
              <p class="hero-card-desc">Triple Twin Engine: Phase 1 (SmallTalk) &rarr; Phase 2 (Intent) &rarr; Phase 3 (Execution). CPU-first, LLM fallback.</p>
              <span class="hero-badge" title="Three-phase control flow that routes from smalltalk to intent to execution">Architecture</span>
            </div>
          </div>

          <div class="hero-card" data-navigate="skills">
            <div class="hero-card-img-wrap">
              <img src="../images/droplets/prime-phuc-skills.png" alt="Skills">
            </div>
            <div class="hero-card-body">
              <h4 class="hero-card-title">Skills Ecosystem</h4>
              <p class="hero-card-desc">Capability modules: prime-safety, prime-coder, phuc-orchestration, and domain skills. Rung-gated publishing.</p>
              <span class="hero-badge" id="badgeSkillsCount" title="Live skill count loaded from /api/skills/list">Skills: --</span>
            </div>
          </div>

          <div class="hero-card" data-navigate="swarms">
            <div class="hero-card-img-wrap">
              <img src="../images/droplets/swarm-node.png" alt="Swarms">
            </div>
            <div class="hero-card-body">
              <h4 class="hero-card-title">Swarm Agents</h4>
              <p class="hero-card-desc">Typed agents: coder, planner, skeptic, scout, mathematician. Each gets a skill pack + persona + model tier.</p>
              <span class="hero-badge" id="badgeSwarmsCount" title="Live swarm count loaded from /api/swarms/list">Swarms: --</span>
            </div>
          </div>

          <div class="hero-card" data-navigate="personas">
            <div class="hero-card-img-wrap">
              <img src="../images/droplets/famous-personas.png" alt="Personas">
            </div>
            <div class="hero-card-body">
              <h4 class="hero-card-title">Famous Personas</h4>
              <p class="hero-card-desc">Donald Knuth (code), Bruce Schneier (security), Barbara Liskov (contracts), Grace Hopper (compilers).</p>
              <span class="hero-badge" id="badgePersonasCount" title="Live persona count loaded from /api/personas/list">Personas: --</span>
            </div>
          </div>

          <div class="hero-card" data-navigate="recipes">
            <div class="hero-card-img-wrap">
              <img src="../images/droplets/recipes.png" alt="Recipes">
            </div>
            <div class="hero-card-body">
              <h4 class="hero-card-title">Recipes &amp; Combos</h4>
              <p class="hero-card-desc">Saved reasoning chains that replay repeatable workflows without re-prompting an LLM every run.</p>
              <span class="hero-badge hero-badge-gold" title="Reusable workflow packs for repeat operations">Workflow Library</span>
            </div>
          </div>

        </div>

        <!-- Quick Start -->
        <div class="quick-start">
          <h5 class="quick-start-heading">Quick Start</h5>
          <ol class="quick-start-list">
            <li>Start your local server: <code>stillwater serve</code>.</li>
            <li>Use the five dashboard cards to open architecture views for each module.</li>
            <li>Configure your default LLM model from the sidebar to enable real status updates.</li>
            <li>Optionally connect a Solace AGI key for cloud sync features.</li>
          </ol>
        </div>
      </div>

      <!-- ================================================
           TAB: ORCHESTRATION
           ================================================ -->
      <div class="tab-pane" id="tab-orchestration">
        <div class="tab-hero">
          <img src="../images/droplets/orchestration.png" alt="Orchestration" class="tab-hero-img">
          <div class="tab-hero-text">
            <h2 class="tab-hero-title">Orchestration Engine</h2>
            <p class="tab-hero-desc"><span class="term-hint" title="Stillwater's three-stage routing model: SmallTalk, Intent, then Execution">Triple Twin</span>: Phase 1 (SmallTalk, 0.70) &rarr; Phase 2 (Intent, 0.80) &rarr; Phase 3 (Execution, 0.90). CPU-first with LLM fallback. Each sub-agent inherits <span class="term-hint" title="Foundational safety skill that overrides conflicting instructions">prime-safety</span> before any domain skill.</p>
          </div>
        </div>
        <div class="mermaid-wrap" id="mermaid-orchestration">
          <div class="mermaid-loading">
            <img src="../images/yinyang/yinyang-loading-128.gif" alt="Loading" class="loading-gif">
            <p class="loading-label">Loading orchestration diagram...</p>
          </div>
        </div>
      </div>

      <!-- ================================================
           TAB: SKILLS
           ================================================ -->
      <div class="tab-pane" id="tab-skills">
        <div class="tab-hero">
          <img src="../images/droplets/prime-phuc-skills.png" alt="Skills" class="tab-hero-img">
          <div class="tab-hero-text">
            <h2 class="tab-hero-title">Skills Ecosystem</h2>
            <p class="tab-hero-desc">Dependency graph of all Stillwater skills. Each skill defines capabilities, constraints, and <span class="term-hint" title="Verification target level used to gate reliability and safety">rung targets</span>. <span class="term-hint" title="Safety skill precedence rule">prime-safety</span> always wins conflicts.</p>
          </div>
        </div>
        <div class="mermaid-wrap" id="mermaid-skills">
          <div class="mermaid-loading">
            <img src="../images/yinyang/yinyang-loading-128.gif" alt="Loading" class="loading-gif">
            <p class="loading-label">Loading skill dependency graph...</p>
          </div>
        </div>
      </div>

      <!-- ================================================
           TAB: SWARMS
           ================================================ -->
      <div class="tab-pane" id="tab-swarms">
        <div class="tab-hero">
          <img src="../images/droplets/swarm-node.png" alt="Swarms" class="tab-hero-img">
          <div class="tab-hero-text">
            <h2 class="tab-hero-title">Agent Dispatch Matrix</h2>
            <p class="tab-hero-desc">Each swarm agent type gets a <span class="term-hint" title="Pre-selected capability bundle assigned to an agent role">typed skill pack</span>, persona, and model tier. Dispatched by the orchestration engine for coding, planning, verification, and research tasks.</p>
          </div>
        </div>
        <div class="mermaid-wrap" id="mermaid-swarms">
          <div class="mermaid-loading">
            <img src="../images/yinyang/yinyang-loading-128.gif" alt="Loading" class="loading-gif">
            <p class="loading-label">Loading swarm dispatch matrix...</p>
          </div>
        </div>
      </div>

      <!-- ================================================
           TAB: PERSONAS
           ================================================ -->
      <div class="tab-pane" id="tab-personas">
        <div class="tab-hero">
          <img src="../images/droplets/famous-personas.png" alt="Personas" class="tab-hero-img">
          <div class="tab-hero-text">
            <h2 class="tab-hero-title">Famous Personas</h2>
            <p class="tab-hero-desc">Domain experts activate specific LLM reasoning styles. Persona lenses are <span class="term-hint" title="Personas adjust communication style, not permissions or capabilities">style-only</span> and cannot grant capabilities.</p>
          </div>
        </div>
        <div class="mermaid-wrap" id="mermaid-personas">
          <div class="mermaid-loading">
            <img src="../images/yinyang/yinyang-loading-128.gif" alt="Loading" class="loading-gif">
            <p class="loading-label">Loading persona state machines...</p>
          </div>
        </div>
      </div>

      <!-- ================================================
           TAB: RECIPES
           ================================================ -->
      <div class="tab-pane" id="tab-recipes">
        <div class="tab-hero">
          <img src="../images/droplets/recipes.png" alt="Recipes" class="tab-hero-img">
          <div class="tab-hero-text">
            <h2 class="tab-hero-title">Recipes &amp; Combos</h2>
            <p class="tab-hero-desc">Saved reasoning chains that replay consistent workflows. The combos directory pairs WISH+RECIPE for planning, bugfix, run-test, CI triage, security, and dependency workflows.</p>
          </div>
        </div>
        <div class="mermaid-wrap" id="mermaid-recipes">
          <div class="mermaid-loading">
            <img src="../images/yinyang/yinyang-loading-128.gif" alt="Loading" class="loading-gif">
            <p class="loading-label">Loading recipe workflow graph...</p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- ======================================================
       LLM WIZARD MODAL
       ====================================================== -->
  <div class="modal-overlay" id="llmModal" role="dialog" aria-modal="true" aria-labelledby="llmModalTitle" aria-hidden="true" tabindex="-1">
    <div class="modal-box">
      <div class="modal-head">
        <span class="modal-title" id="llmModalTitle">LLM Configuration</span>
        <button class="modal-close" id="btnCloseLLM" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-notice" id="llmModalNotice" aria-live="polite"></div>
        <div class="wizard-step" id="llmStep1">
          <h6 class="wizard-step-heading">Step 1: Select Default Model</h6>
          <div class="model-selection">
            <label class="model-option">
              <input type="radio" name="llmModel" value="haiku" checked>
              <span class="model-option-content">
                <span class="model-name">Haiku <span class="model-tag">Fast</span></span>
                <span class="model-desc">Coordination, scaffolding, volume tasks</span>
              </span>
            </label>
            <label class="model-option">
              <input type="radio" name="llmModel" value="sonnet">
              <span class="model-option-content">
                <span class="model-name">Sonnet <span class="model-tag">Balanced</span></span>
                <span class="model-desc">Coding, planning, domain work</span>
              </span>
            </label>
            <label class="model-option">
              <input type="radio" name="llmModel" value="opus">
              <span class="model-option-content">
                <span class="model-name">Opus <span class="model-tag">Powerful</span></span>
                <span class="model-desc">Math, security, adversarial audit</span>
              </span>
            </label>
          </div>
          <div class="wizard-check-row">
            <label class="wizard-check-label">
              <input type="checkbox" id="autoStart" checked>
              Auto-start wrapper on boot
            </label>
          </div>
          <div class="wizard-actions">
            <button class="btn-primary" id="btnSaveLLM">Save Configuration</button>
            <button class="btn-secondary" id="btnCancelLLM">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ======================================================
       SOLACE AGI WIZARD MODAL
       ====================================================== -->
  <div class="modal-overlay" id="solaceModal" role="dialog" aria-modal="true" aria-labelledby="solaceModalTitle" aria-hidden="true" tabindex="-1">
    <div class="modal-box">
      <div class="modal-head">
        <span class="modal-title" id="solaceModalTitle">Connect to Solace AGI</span>
        <button class="modal-close" id="btnCloseSolace" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-notice" id="solaceModalNotice" aria-live="polite"></div>
        <div class="wizard-step" id="solaceStep1">
          <h6 class="wizard-step-heading">API Key</h6>
          <p class="wizard-step-desc">Enter your API key from <a class="link-cyan" href="https://www.solaceagi.com" target="_blank" rel="noopener">solaceagi.com</a></p>
          <input
            type="password"
            class="form-input"
            id="solaceApiKey"
            placeholder="sw_sk_..."
            autocomplete="off"
          >
          <div class="wizard-actions">
            <button class="btn-primary" id="btnSaveSolace">Connect</button>
            <button class="btn-secondary" id="btnCancelSolace">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- App script (single file — all logic merged) -->
  <script src="app.js"></script>
</body>
</html>
