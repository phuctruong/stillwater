name: Integration (Ollama)

on:
  workflow_dispatch:
    inputs:
      ollama_url:
        description: "Ollama base URL (runner-local)."
        required: true
        default: "http://localhost:11434"
      model:
        description: "Ollama model name to use."
        required: true
        default: "qwen2.5-coder:7b"
      timeout_seconds:
        description: "Per-request timeout seconds."
        required: true
        default: "120"

jobs:
  skills_ab_ollama:
    # GitHub-hosted runners do not ship with Ollama.
    # Run this on a self-hosted runner where Ollama is already installed and running.
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      - name: Install
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e ".[dev]"
      - name: Skills A/B (ollama backend)
        env:
          PYTHONPATH: src
        run: |
          python -m stillwater.skills_ab \
            --backend ollama \
            --ollama-url "${{ inputs.ollama_url }}" \
            --model "${{ inputs.model }}" \
            --cache 0 \
            --timeout "${{ inputs.timeout_seconds }}"
      - name: Upload receipts
        uses: actions/upload-artifact@v4
        with:
          name: skills_ab_receipts
          path: artifacts/skills_ab/
